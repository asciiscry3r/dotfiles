#!/usr/bin/env bash

ps aux | grep '/usr/bin/bash /home/max/.config/i3/autostart' | awk '{print $2}' | xargs kill

dunstapparmor() {
    while true; do
	ps aux | grep 'sleep 150' | awk '{print $2}' | xargs kill
	ps aux | grep 'sleep 6000' | awk '{print $2}' | xargs kill
	dunstctl rule apparmor-display-skip disable
	sleep 150
	dunstctl rule apparmor-display disable
	dunstctl rule apparmor-display-skip enable
	dunstify 'apparmor notification for firefox temporary disabled'
	sleep 6000
	dunstctl rule apparmor-display-skip disable
	dunstctl rule apparmor-display enable
	dunstify 'apparmor notification for firefox enabled'
    done
}

# configure X
xset -b
xset r rate 400 60
xhost -

sleep 1

setxkbmap -layout us,ru,ua
setxkbmap -option grp:alt_shift_toggle

killall redshift

sleep 1

# start userspace environmet utils

DISPLAY=:%i emacs --fg-daemon -- &

terminaldaemoncount=`pgrep urxvtd | wc -l` 

if [ $terminaldaemoncount == 1 ]; then
    notify-send "terminal daemon is started"
else
    killall urxvtd
    urxvtd -q -o &
fi

sleep 1

killall picom; picom -b -- &

killall dunst; dunst -- &

# dunstapparmor &

# firejail --noroot --apparmor --seccomp --name=clipit /usr/bin/clipit -- -- &

sleep 1

notify-send "hello ${USER} -_-
	    start redshift and apparmor parcer"

# start apparmor parces

redshift -t 6000:5000 -l 49.9627:33.6053 -- &

aa-notify -p -l -w 60 -f /var/log/audit/audit.log &
